# è„šæœ¬ vs Workflowï¼šå®ƒä»¬çš„å…³ç³»å’ŒåŒºåˆ«

## ç®€å•æ€»ç»“

- **æ‰‹åŠ¨ Git æ“ä½œ**ï¼šåŒæ­¥ã€åˆå¹¶ã€æ‰“ tagã€æ¨é€
- **Workflow (`.github/workflows/build-image.yml`)**ï¼šç›‘å¬ Git äº‹ä»¶ï¼Œè‡ªåŠ¨æ„å»º Docker é•œåƒ

**å·¥ä½œæµç¨‹**ï¼šæ‰‹åŠ¨æ‰“ tag å¹¶æ¨é€ â†’ workflow è‡ªåŠ¨æ£€æµ‹å¹¶æ„å»ºé•œåƒã€‚

---

## è¯¦ç»†å¯¹æ¯”

### æ‰‹åŠ¨ Git æ“ä½œ

**ä½œç”¨**ï¼šç‰ˆæœ¬ç®¡ç†å’Œ tag åˆ›å»º

**éœ€è¦åšä»€ä¹ˆ**ï¼š
1. âœ… åŒæ­¥ `upstream/main` åˆ°ä½ çš„ `main`ï¼ˆå¯é€‰ï¼‰
2. âœ… åˆå¹¶ `main` åˆ° `custom-ui-fix` åˆ†æ”¯ï¼ˆå¦‚æœéœ€è¦ï¼‰
3. âœ… æ‰“ tagï¼ˆå¦‚ `v4.5.2`ï¼‰
4. âœ… æ¨é€ tag åˆ° GitHub

**ä¸åšä»€ä¹ˆ**ï¼š
- âŒ ä¸æ„å»º Docker é•œåƒ
- âŒ ä¸æ¨é€é•œåƒåˆ° Docker Hub

**ä½•æ—¶ä½¿ç”¨**ï¼š
- ğŸ¯ **å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶**
- ğŸ¯ éœ€è¦åˆ›å»ºç‰ˆæœ¬ tag æ—¶

**æ“ä½œæ–¹å¼**ï¼š
```bash
git tag v4.5.2
git push origin v4.5.2
```

---

### Workflowï¼š`.github/workflows/build-image.yml`

**ä½œç”¨**ï¼šGitHub Actions è‡ªåŠ¨åŒ–æ„å»º

**åšä»€ä¹ˆ**ï¼š
1. âœ… ç›‘å¬ Git äº‹ä»¶ï¼ˆpush åˆ°åˆ†æ”¯æˆ– tagï¼‰
2. âœ… æ„å»º Docker é•œåƒï¼ˆweb å’Œ streamingï¼‰
3. âœ… æ¨é€åˆ° Docker Hubï¼ˆ`bailongctui/mastodon:*`ï¼‰

**ä¸åšä»€ä¹ˆ**ï¼š
- âŒ ä¸ç®¡ç† Git åˆ†æ”¯
- âŒ ä¸æ‰“ tag
- âŒ ä¸åŒæ­¥ä¸Šæ¸¸ä»£ç 

**ä½•æ—¶è§¦å‘**ï¼š
- ğŸ¯ **è‡ªåŠ¨è§¦å‘**ï¼šå½“ä½  push åˆ° `custom-ui-fix` åˆ†æ”¯æ—¶
- ğŸ¯ **è‡ªåŠ¨è§¦å‘**ï¼šå½“ä½  push tagï¼ˆå¦‚ `v4.5.2`ï¼‰æ—¶
- ğŸ¯ **æ‰‹åŠ¨è§¦å‘**ï¼šåœ¨ GitHub Actions é¡µé¢ç‚¹å‡» "Run workflow"

**è§¦å‘æ–¹å¼**ï¼š
- è‡ªåŠ¨ï¼šè„šæœ¬æ¨é€ tag åè‡ªåŠ¨è§¦å‘
- æ‰‹åŠ¨ï¼šGitHub Actions UI ä¸­æ‰‹åŠ¨è¿è¡Œ

---

## å·¥ä½œæµç¨‹ç¤ºä¾‹

### åœºæ™¯ 1ï¼šå‘å¸ƒæ–°ç‰ˆæœ¬

```bash
# 1. ç¡®ä¿åœ¨æ­£ç¡®çš„åˆ†æ”¯ä¸Š
git checkout custom-ui-fix

# 2. æ‰“ tag å¹¶æ¨é€
git tag v4.5.2
git push origin v4.5.2

# 3. GitHub Actions è‡ªåŠ¨æ£€æµ‹åˆ° tagï¼Œå¼€å§‹æ„å»º
# - æ„å»º bailongctui/mastodon:4.5.2
# - æ„å»º bailongctui/mastodon-streaming:4.5.2
# - å¦‚æœ tag æ˜¯ v4.5.*ï¼Œè¿˜ä¼šæ‰“ latest æ ‡ç­¾
```

### åœºæ™¯ 2ï¼šå¼€å‘æ—¶è‡ªåŠ¨æ„å»ºï¼ˆä¸éœ€è¦è„šæœ¬ï¼‰

```bash
# 1. åœ¨ custom-ui-fix åˆ†æ”¯ä¸Šå¼€å‘
git checkout custom-ui-fix
# ... ä¿®æ”¹ä»£ç  ...

# 2. æäº¤å¹¶æ¨é€
git add .
git commit -m "Update UI"
git push origin custom-ui-fix

# 3. GitHub Actions è‡ªåŠ¨æ£€æµ‹åˆ° pushï¼Œå¼€å§‹æ„å»º
# - æ„å»º bailongctui/mastodon:latest
# - æ„å»º bailongctui/mastodon-streaming:latest
```

### åœºæ™¯ 3ï¼šæ‰‹åŠ¨è§¦å‘æ„å»ºï¼ˆä¸éœ€è¦è„šæœ¬ï¼‰

1. æ‰“å¼€ GitHub Actions é¡µé¢
2. é€‰æ‹© "Build and Push Custom Mastodon" workflow
3. ç‚¹å‡» "Run workflow"
4. é€‰æ‹©åˆ†æ”¯ï¼ˆå¦‚ `custom-ui-fix`ï¼‰
5. ç‚¹å‡» "Run workflow" æŒ‰é’®

---

## å¸¸è§é—®é¢˜

### Q: æˆ‘åº”è¯¥ç”¨è„šæœ¬è¿˜æ˜¯ç›´æ¥ pushï¼Ÿ

**A**: 
- **å‘å¸ƒç‰ˆæœ¬**ï¼šç”¨è„šæœ¬ï¼ˆç¡®ä¿ç‰ˆæœ¬ç®¡ç†è§„èŒƒï¼‰
- **æ—¥å¸¸å¼€å‘**ï¼šç›´æ¥ push åˆ° `custom-ui-fix`ï¼ˆworkflow ä¼šè‡ªåŠ¨æ„å»ºï¼‰

### Q: ä¸¤è€…ä¼šå†²çªå—ï¼Ÿ

**A**: ä¸ä¼šã€‚è„šæœ¬è´Ÿè´£ Git æ“ä½œï¼Œworkflow è´Ÿè´£æ„å»ºã€‚è„šæœ¬æ¨é€ tag â†’ workflow æ£€æµ‹åˆ° tag â†’ è‡ªåŠ¨æ„å»ºã€‚

### Q: å¦‚æœæˆ‘åª push åˆ†æ”¯ï¼Œä¸è¿è¡Œè„šæœ¬ä¼šæ€æ ·ï¼Ÿ

**A**: 
- Workflow ä¼šè§¦å‘ï¼Œæ„å»º `latest` æ ‡ç­¾
- ä½†ä¸ä¼šæœ‰ç‰ˆæœ¬å· tagï¼ˆå¦‚ `v4.5.2`ï¼‰
- ä¸ä¼šæœ‰ `stable-<version>` åˆ†æ”¯
- é€‚åˆå¼€å‘æµ‹è¯•ï¼Œä¸é€‚åˆæ­£å¼å‘å¸ƒ

### Q: å¦‚æœæˆ‘åªè¿è¡Œè„šæœ¬ï¼Œä¸ push ä¼šæ€æ ·ï¼Ÿ

**A**: 
- è„šæœ¬ä¼šå¤±è´¥ï¼ˆéœ€è¦ push æ‰èƒ½è§¦å‘ workflowï¼‰
- å¿…é¡» push tag æ‰èƒ½è§¦å‘æ„å»º

### Q: å¯ä»¥è·³è¿‡è„šæœ¬ï¼Œæ‰‹åŠ¨æ‰“ tag å—ï¼Ÿ

**A**: å¯ä»¥ï¼Œä½†ä¸æ¨èï¼š
```bash
git tag v4.5.2
git push origin v4.5.2
# Workflow ä¼šè‡ªåŠ¨è§¦å‘æ„å»º
```
**é—®é¢˜**ï¼š
- ä¸ä¼šåŒæ­¥ upstream
- ä¸ä¼šåˆ›å»º stable åˆ†æ”¯
- ä¸ä¼šåˆå¹¶æœ€æ–°ä»£ç 
- å®¹æ˜“å‡ºé”™

---

## æ¨èå·¥ä½œæµ

### æ—¥å¸¸å¼€å‘
```bash
# 1. åœ¨ custom-ui-fix åˆ†æ”¯å¼€å‘
git checkout custom-ui-fix
# ... ä¿®æ”¹ä»£ç  ...

# 2. æäº¤å¹¶æ¨é€ï¼ˆè‡ªåŠ¨è§¦å‘ latest æ„å»ºï¼‰
git push origin custom-ui-fix
```

### å‘å¸ƒç‰ˆæœ¬
```bash
# 1. æ‰“ tag å¹¶æ¨é€ï¼ˆæ‰‹åŠ¨æ“ä½œï¼‰
git tag v4.5.2
git push origin v4.5.2

# 2. ç­‰å¾… GitHub Actions å®Œæˆæ„å»º

# 3. åœ¨æœåŠ¡å™¨ä¸Šæ‹‰å–æ–°é•œåƒ
docker pull bailongctui/mastodon:4.5.2
# æˆ–
docker pull bailongctui/mastodon:latest
```

---

## æ€»ç»“

| åŠŸèƒ½ | æ‰‹åŠ¨ Git æ“ä½œ | Workflow |
|------|-------------|----------|
| Git æ“ä½œ | âœ… | âŒ |
| åŒæ­¥ upstream | âœ… | âŒ |
| æ‰“ tag | âœ… | âŒ |
| æ„å»ºé•œåƒ | âŒ | âœ… |
| æ¨é€é•œåƒ | âŒ | âœ… |
| è‡ªåŠ¨åŒ– | æ‰‹åŠ¨æ“ä½œ | è‡ªåŠ¨è§¦å‘ |

**æœ€ä½³å®è·µ**ï¼š
- ğŸ¯ æ—¥å¸¸å¼€å‘ï¼šç›´æ¥ push â†’ workflow è‡ªåŠ¨æ„å»º `latest`
- ğŸ¯ ç‰ˆæœ¬å‘å¸ƒï¼šæ‰‹åŠ¨æ‰“ tag â†’ workflow è‡ªåŠ¨æ„å»ºç‰ˆæœ¬å·é•œåƒ

